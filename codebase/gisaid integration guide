# GISAID Integration Configuration and Setup Guide

## ğŸ“‹ **Prerequisites**

### 1. GISAID Access
- Register at https://www.gisaid.org
- Request access credentials (usually takes 1-2 days)
- Download metadata files from EpiCoV database

### 2. Required Python Packages
```bash
pip install pandas numpy scipy matplotlib seaborn plotly
pip install aiohttp asyncio  # For async API calls
pip install biopython  # For sequence analysis
```

## ğŸ”‘ **Configuration File**

Create a file named `gisaid_config.json`:

```json
{
    "credentials": {
        "username": "YOUR_GISAID_USERNAME",
        "password": "YOUR_GISAID_PASSWORD"
    },
    "surveillance_settings": {
        "update_frequency": "daily",
        "window_days": 30,
        "min_sequences_threshold": 10,
        "alert_thresholds": {
            "growth_rate": 0.5,
            "prevalence_change": 10.0,
            "geographic_spread": 5,
            "escape_score": 0.7
        }
    },
    "antibody_profiles": [
        {
            "name": "mAb-001",
            "sequence": "QVQLVQSGAEVKKPGS...",
            "epitope_class": "Class 1",
            "ic50_threshold": 100
        }
    ],
    "output_settings": {
        "output_directory": "./gisaid_surveillance",
        "generate_html_reports": true,
        "email_alerts": false
    }
}
```

## ğŸš€ **Quick Start Guide**

### Step 1: Download GISAID Metadata

1. Login to GISAID EpiCoV
2. Go to "Downloads" section
3. Download metadata file (TSV format)
4. Save as `gisaid_metadata.tsv`

### Step 2: Basic Usage

```python
from gisaid_variant_tracker import GISAIDAnalysisPipeline
import json

# Load configuration
with open('gisaid_config.json', 'r') as f:
    config = json.load(f)

# Initialize pipeline
pipeline = GISAIDAnalysisPipeline(
    gisaid_credentials=config['credentials']
)

# Run surveillance
results = pipeline.run_surveillance(
    metadata_file='gisaid_metadata.tsv',
    antibody_sequences=[ab['sequence'] for ab in config['antibody_profiles']],
    output_dir=config['output_settings']['output_directory']
)

# Check emerging threats
for threat in results['emerging_threats'][:5]:
    print(f"{threat.lineage}: {threat.threat_level} risk")
    print(f"  Growth rate: {threat.growth_rate:.2f}")
    print(f"  Escape score: {threat.antibody_escape_score:.2f}")
```

## ğŸ“Š **Integration with Antibody Pipeline**

### Complete Workflow Integration

```python
from berean_protocol_fixed import OmniSynapticBindingPredictor
from antibody_research_module import AntibodyAnalysisPipeline
from variant_analysis_module import VariantAnalyzer
from gisaid_variant_tracker import GISAIDAnalysisPipeline, RealTimeVariantMonitor

class IntegratedAntibodyPlatform:
    """
    Unified platform combining all modules
    """
    
    def __init__(self, config_file='gisaid_config.json'):
        # Load config
        with open(config_file, 'r') as f:
            self.config = json.load(f)
        
        # Initialize modules
        self.binding_predictor = OmniSynapticBindingPredictor()
        self.antibody_analyzer = AntibodyAnalysisPipeline(self.binding_predictor)
        self.variant_analyzer = VariantAnalyzer()
        self.gisaid_pipeline = GISAIDAnalysisPipeline(
            self.config['credentials']
        )
        
    def evaluate_antibody_candidate(self, 
                                   antibody_seq: str,
                                   antigen_seq: str,
                                   gisaid_metadata: str):
        """
        Complete evaluation of an antibody candidate
        """
        results = {}
        
        # 1. Basic binding prediction
        binding_results = self.antibody_analyzer.comprehensive_analysis(
            antibody_seq, antigen_seq
        )
        results['binding'] = binding_results
        
        # 2. Variant analysis (known variants)
        variant_breadth = self.variant_analyzer.predict_neutralization_breadth(
            antibody_seq, antigen_seq
        )
        results['known_variants'] = variant_breadth
        
        # 3. Real-time GISAID surveillance
        gisaid_results = self.gisaid_pipeline.run_surveillance(
            metadata_file=gisaid_metadata,
            antibody_sequences=[antibody_seq]
        )
        results['emerging_variants'] = gisaid_results
        
        # 4. Generate integrated report
        self._generate_integrated_report(results, antibody_seq)
        
        return results
    
    def _generate_integrated_report(self, results, antibody_seq):
        """Generate comprehensive report combining all analyses"""
        
        report = f"""
INTEGRATED ANTIBODY EVALUATION REPORT
=====================================
Antibody: {antibody_seq[:30]}...

1. BINDING CHARACTERISTICS
--------------------------
Binding Probability: {results['binding'].get('binding_probability', 0):.3f}
CDR Regions: {len(results['binding'].get('cdr_regions', {}))}
Key Epitopes: {len(results['binding'].get('epitope_residues', []))}

2. KNOWN VARIANT COVERAGE
-------------------------
Effective Against: {(results['known_variants']['Breadth_Category'] == 'Effective').sum()} variants
Reduced Against: {(results['known_variants']['Breadth_Category'] == 'Reduced').sum()} variants
Resistant: {(results['known_variants']['Breadth_Category'] == 'Resistant').sum()} variants

3. EMERGING THREATS (GISAID)
---------------------------
Critical Threats: {sum(1 for t in results['emerging_variants']['emerging_threats'] 
                      if t.threat_level == 'Critical')}
High Risk: {sum(1 for t in results['emerging_variants']['emerging_threats'] 
               if t.threat_level == 'High')}
Active Alerts: {len(results['emerging_variants']['alerts'])}

RECOMMENDATION: {self._get_recommendation(results)}
"""
        print(report)
        return report
    
    def _get_recommendation(self, results):
        """Generate recommendation based on all analyses"""
        
        score = 0
        max_score = 10
        
        # Binding score (0-3)
        binding_prob = results['binding'].get('binding_probability', 0)
        score += min(3, binding_prob * 3)
        
        # Variant breadth (0-4)
        if 'known_variants' in results:
            breadth = (results['known_variants']['Breadth_Category'] == 'Effective').mean()
            score += breadth * 4
        
        # Emerging threat resistance (0-3)
        if 'emerging_variants' in results:
            threats = results['emerging_variants']['emerging_threats']
            if len(threats) == 0:
                score += 3
            else:
                high_risk = sum(1 for t in threats if t.threat_level in ['Critical', 'High'])
                score += max(0, 3 - high_risk * 0.5)
        
        # Generate recommendation
        if score >= 8:
            return "STRONG CANDIDATE - Advance to preclinical development"
        elif score >= 6:
            return "PROMISING - Consider optimization or cocktail approach"
        elif score >= 4:
            return "MODERATE - Significant optimization needed"
        else:
            return "POOR - Not recommended for development"

# Usage example
platform = IntegratedAntibodyPlatform()
results = platform.evaluate_antibody_candidate(
    antibody_seq="YOUR_ANTIBODY_SEQUENCE",
    antigen_seq="SPIKE_PROTEIN_SEQUENCE",
    gisaid_metadata="gisaid_metadata.tsv"
)
```

## ğŸ“ˆ **Automated Daily Surveillance**

### Setting up a Daily Monitor

```python
import schedule
import time
from datetime import datetime

class DailySurveillanceMonitor:
    """
    Automated daily GISAID surveillance
    """
    
    def __init__(self, config_file='gisaid_config.json'):
        with open(config_file, 'r') as f:
            self.config = json.load(f)
        self.pipeline = GISAIDAnalysisPipeline(
            self.config['credentials']
        )
        self.previous_analysis = None
        
    def run_daily_check(self):
        """Run daily surveillance check"""
        print(f"\n[{datetime.now()}] Running daily surveillance...")
        
        # Download latest metadata (would need GISAID API in production)
        metadata_file = self.download_latest_metadata()
        
        # Run analysis
        results = self.pipeline.run_surveillance(
            metadata_file=metadata_file,
            antibody_sequences=[ab['sequence'] 
                              for ab in self.config['antibody_profiles']]
        )
        
        # Check for significant changes
        if self.previous_analysis:
            self.compare_analyses(self.previous_analysis, results)
        
        self.previous_analysis = results
        
        # Send alerts if needed
        if results['alerts']:
            self.send_alerts(results['alerts'])
    
    def download_latest_metadata(self):
        """Download latest GISAID metadata"""
        # In production, this would use GISAID API
        # For now, return local file
        return "gisaid_metadata.tsv"
    
    def compare_analyses(self, previous, current):
        """Compare analyses for significant changes"""
        # Check for new threats
        prev_threats = {t.lineage for t in previous['emerging_threats']}
        curr_threats = {t.lineage for t in current['emerging_threats']}
        
        new_threats = curr_threats - prev_threats
        if new_threats:
            print(f"âš ï¸  NEW THREATS DETECTED: {new_threats}")
    
    def send_alerts(self, alerts):
        """Send alert notifications"""
        high_priority = [a for a in alerts if a['severity'] == 'HIGH']
        if high_priority:
            print(f"ğŸš¨ {len(high_priority)} HIGH PRIORITY ALERTS!")
            # In production, send email/Slack notifications
    
    def start_monitoring(self):
        """Start automated monitoring"""
        # Schedule daily runs
        schedule.every().day.at("09:00").do(self.run_daily_check)
        
        print("Daily surveillance monitor started...")
        print("Scheduled for 9:00 AM daily")
        
        # Run initial check
        self.run_daily_check()
        
        # Keep running
        while True:
            schedule.run_pending()
            time.sleep(60)

# Start automated surveillance
monitor = DailySurveillanceMonitor()
# monitor.start_monitoring()  # Uncomment to run
```

## ğŸ”¬ **Research Applications**

### 1. Antibody Cocktail Design
```python
def design_variant_resistant_cocktail(antibodies, gisaid_data):
    """
    Design cocktail covering maximum variants
    """
    # Analyze each antibody against variants
    coverage_matrix = []
    
    for ab in antibodies:
        coverage = analyze_variant_coverage(ab, gisaid_data)
        coverage_matrix.append(coverage)
    
    # Find optimal combination
    best_combination = optimize_cocktail_coverage(coverage_matrix)
    return best_combination
```

### 2. Escape Mutation Monitoring
```python
def monitor_escape_mutations(antibody_seq, gisaid_updates):
    """
    Track emergence of escape mutations
    """
    escape_positions = identify_escape_hotspots(antibody_seq)
    
    for update in gisaid_updates:
        new_mutations = extract_mutations(update)
        
        # Check if any affect escape positions
        escape_risk = assess_escape_risk(new_mutations, escape_positions)
        
        if escape_risk > threshold:
            trigger_alert(f"Escape mutation detected: {new_mutations}")
```

### 3. Pandemic Preparedness
```python
def assess_pandemic_readiness(antibody_library, emerging_variants):
    """
    Evaluate library coverage of emerging threats
    """
    readiness_scores = {}
    
    for variant in emerging_variants:
        coverage = 0
        for antibody in antibody_library:
            if predicts_neutralization(antibody, variant):
                coverage += 1
        
        readiness_scores[variant] = coverage / len(antibody_library)
    
    return readiness_scores
```

## ğŸ“ **Output Files Generated**

1. **`prevalence_timeline.html`** - Interactive variant prevalence over time
2. **`geographic_distribution.html`** - Global variant distribution map
3. **`surveillance_report.txt`** - Comprehensive text report
4. **`variant_alerts.txt`** - Alert notifications
5. **`emerging_threats.json`** - JSON data of emerging variants

## ğŸ”— **Data Sources**

- **GISAID**: https://www.gisaid.org
- **CoVariants**: https://covariants.org
- **Nextstrain**: https://nextstrain.org
- **CDC Variant Tracker**: https://covid.cdc.gov/covid-data-tracker/#variant-proportions

## ğŸ“ **Support**

For GISAID access issues:
- Contact: hcov-19@gisaid.org
- Documentation: https://www.gisaid.org/help

For technical issues with this module:
- Check the error logs in `./gisaid_surveillance/errors.log`
- Ensure all dependencies are installed
- Verify GISAID credentials are correct

## ğŸš¨ **Important Notes**

1. **GISAID Terms of Use**: Respect GISAID data sharing agreement
2. **Citation Requirements**: Cite GISAID in any publications
3. **Data Privacy**: Do not share patient-identifiable information
4. **Update Frequency**: GISAID updates continuously; check daily for best results
# GISAID Integration Configuration and Setup Guide

## ğŸ“‹ **Prerequisites**

### 1. GISAID Access
- Register at https://www.gisaid.org
- Request access credentials (usually takes 1-2 days)
- Download metadata files from EpiCoV database

### 2. Required Python Packages
```bash
pip install pandas numpy scipy matplotlib seaborn plotly
pip install aiohttp asyncio  # For async API calls
pip install biopython  # For sequence analysis
```

## ğŸ”‘ **Configuration File**

Create a file named `gisaid_config.json`:

```json
{
    "credentials": {
        "username": "YOUR_GISAID_USERNAME",
        "password": "YOUR_GISAID_PASSWORD"
    },
    "surveillance_settings": {
        "update_frequency": "daily",
        "window_days": 30,
        "min_sequences_threshold": 10,
        "alert_thresholds": {
            "growth_rate": 0.5,
            "prevalence_change": 10.0,
            "geographic_spread": 5,
            "escape_score": 0.7
        }
    },
    "antibody_profiles": [
        {
            "name": "mAb-001",
            "sequence": "QVQLVQSGAEVKKPGS...",
            "epitope_class": "Class 1",
            "ic50_threshold": 100
        }
    ],
    "output_settings": {
        "output_directory": "./gisaid_surveillance",
        "generate_html_reports": true,
        "email_alerts": false
    }
}
```

## ğŸš€ **Quick Start Guide**

### Step 1: Download GISAID Metadata

1. Login to GISAID EpiCoV
2. Go to "Downloads" section
3. Download metadata file (TSV format)
4. Save as `gisaid_metadata.tsv`

### Step 2: Basic Usage

```python
from gisaid_variant_tracker import GISAIDAnalysisPipeline
import json

# Load configuration
with open('gisaid_config.json', 'r') as f:
    config = json.load(f)

# Initialize pipeline
pipeline = GISAIDAnalysisPipeline(
    gisaid_credentials=config['credentials']
)

# Run surveillance
results = pipeline.run_surveillance(
    metadata_file='gisaid_metadata.tsv',
    antibody_sequences=[ab['sequence'] for ab in config['antibody_profiles']],
    output_dir=config['output_settings']['output_directory']
)

# Check emerging threats
for threat in results['emerging_threats'][:5]:
    print(f"{threat.lineage}: {threat.threat_level} risk")
    print(f"  Growth rate: {threat.growth_rate:.2f}")
    print(f"  Escape score: {threat.antibody_escape_score:.2f}")
```

## ğŸ“Š **Integration with Antibody Pipeline**

### Complete Workflow Integration

```python
from berean_protocol_fixed import OmniSynapticBindingPredictor
from antibody_research_module import AntibodyAnalysisPipeline
from variant_analysis_module import VariantAnalyzer
from gisaid_variant_tracker import GISAIDAnalysisPipeline, RealTimeVariantMonitor

class IntegratedAntibodyPlatform:
    """
    Unified platform combining all modules
    """
    
    def __init__(self, config_file='gisaid_config.json'):
        # Load config
        with open(config_file, 'r') as f:
            self.config = json.load(f)
        
        # Initialize modules
        self.binding_predictor = OmniSynapticBindingPredictor()
        self.antibody_analyzer = AntibodyAnalysisPipeline(self.binding_predictor)
        self.variant_analyzer = VariantAnalyzer()
        self.gisaid_pipeline = GISAIDAnalysisPipeline(
            self.config['credentials']
        )
        
    def evaluate_antibody_candidate(self, 
                                   antibody_seq: str,
                                   antigen_seq: str,
                                   gisaid_metadata: str):
        """
        Complete evaluation of an antibody candidate
        """
        results = {}
        
        # 1. Basic binding prediction
        binding_results = self.antibody_analyzer.comprehensive_analysis(
            antibody_seq, antigen_seq
        )
        results['binding'] = binding_results
        
        # 2. Variant analysis (known variants)
        variant_breadth = self.variant_analyzer.predict_neutralization_breadth(
            antibody_seq, antigen_seq
        )
        results['known_variants'] = variant_breadth
        
        # 3. Real-time GISAID surveillance
        gisaid_results = self.gisaid_pipeline.run_surveillance(
            metadata_file=gisaid_metadata,
            antibody_sequences=[antibody_seq]
        )
        results['emerging_variants'] = gisaid_results
        
        # 4. Generate integrated report
        self._generate_integrated_report(results, antibody_seq)
        
        return results
    
    def _generate_integrated_report(self, results, antibody_seq):
        """Generate comprehensive report combining all analyses"""
        
        report = f"""
INTEGRATED ANTIBODY EVALUATION REPORT
=====================================
Antibody: {antibody_seq[:30]}...

1. BINDING CHARACTERISTICS
--------------------------
Binding Probability: {results['binding'].get('binding_probability', 0):.3f}
CDR Regions: {len(results['binding'].get('cdr_regions', {}))}
Key Epitopes: {len(results['binding'].get('epitope_residues', []))}

2. KNOWN VARIANT COVERAGE
-------------------------
Effective Against: {(results['known_variants']['Breadth_Category'] == 'Effective').sum()} variants
Reduced Against: {(results['known_variants']['Breadth_Category'] == 'Reduced').sum()} variants
Resistant: {(results['known_variants']['Breadth_Category'] == 'Resistant').sum()} variants

3. EMERGING THREATS (GISAID)
---------------------------
Critical Threats: {sum(1 for t in results['emerging_variants']['emerging_threats'] 
                      if t.threat_level == 'Critical')}
High Risk: {sum(1 for t in results['emerging_variants']['emerging_threats'] 
               if t.threat_level == 'High')}
Active Alerts: {len(results['emerging_variants']['alerts'])}

RECOMMENDATION: {self._get_recommendation(results)}
"""
        print(report)
        return report
    
    def _get_recommendation(self, results):
        """Generate recommendation based on all analyses"""
        
        score = 0
        max_score = 10
        
        # Binding score (0-3)
        binding_prob = results['binding'].get('binding_probability', 0)
        score += min(3, binding_prob * 3)
        
        # Variant breadth (0-4)
        if 'known_variants' in results:
            breadth = (results['known_variants']['Breadth_Category'] == 'Effective').mean()
            score += breadth * 4
        
        # Emerging threat resistance (0-3)
        if 'emerging_variants' in results:
            threats = results['emerging_variants']['emerging_threats']
            if len(threats) == 0:
                score += 3
            else:
                high_risk = sum(1 for t in threats if t.threat_level in ['Critical', 'High'])
                score += max(0, 3 - high_risk * 0.5)
        
        # Generate recommendation
        if score >= 8:
            return "STRONG CANDIDATE - Advance to preclinical development"
        elif score >= 6:
            return "PROMISING - Consider optimization or cocktail approach"
        elif score >= 4:
            return "MODERATE - Significant optimization needed"
        else:
            return "POOR - Not recommended for development"

# Usage example
platform = IntegratedAntibodyPlatform()
results = platform.evaluate_antibody_candidate(
    antibody_seq="YOUR_ANTIBODY_SEQUENCE",
    antigen_seq="SPIKE_PROTEIN_SEQUENCE",
    gisaid_metadata="gisaid_metadata.tsv"
)
```

## ğŸ“ˆ **Automated Daily Surveillance**

### Setting up a Daily Monitor

```python
import schedule
import time
from datetime import datetime

class DailySurveillanceMonitor:
    """
    Automated daily GISAID surveillance
    """
    
    def __init__(self, config_file='gisaid_config.json'):
        with open(config_file, 'r') as f:
            self.config = json.load(f)
        self.pipeline = GISAIDAnalysisPipeline(
            self.config['credentials']
        )
        self.previous_analysis = None
        
    def run_daily_check(self):
        """Run daily surveillance check"""
        print(f"\n[{datetime.now()}] Running daily surveillance...")
        
        # Download latest metadata (would need GISAID API in production)
        metadata_file = self.download_latest_metadata()
        
        # Run analysis
        results = self.pipeline.run_surveillance(
            metadata_file=metadata_file,
            antibody_sequences=[ab['sequence'] 
                              for ab in self.config['antibody_profiles']]
        )
        
        # Check for significant changes
        if self.previous_analysis:
            self.compare_analyses(self.previous_analysis, results)
        
        self.previous_analysis = results
        
        # Send alerts if needed
        if results['alerts']:
            self.send_alerts(results['alerts'])
    
    def download_latest_metadata(self):
        """Download latest GISAID metadata"""
        # In production, this would use GISAID API
        # For now, return local file
        return "gisaid_metadata.tsv"
    
    def compare_analyses(self, previous, current):
        """Compare analyses for significant changes"""
        # Check for new threats
        prev_threats = {t.lineage for t in previous['emerging_threats']}
        curr_threats = {t.lineage for t in current['emerging_threats']}
        
        new_threats = curr_threats - prev_threats
        if new_threats:
            print(f"âš ï¸  NEW THREATS DETECTED: {new_threats}")
    
    def send_alerts(self, alerts):
        """Send alert notifications"""
        high_priority = [a for a in alerts if a['severity'] == 'HIGH']
        if high_priority:
            print(f"ğŸš¨ {len(high_priority)} HIGH PRIORITY ALERTS!")
            # In production, send email/Slack notifications
    
    def start_monitoring(self):
        """Start automated monitoring"""
        # Schedule daily runs
        schedule.every().day.at("09:00").do(self.run_daily_check)
        
        print("Daily surveillance monitor started...")
        print("Scheduled for 9:00 AM daily")
        
        # Run initial check
        self.run_daily_check()
        
        # Keep running
        while True:
            schedule.run_pending()
            time.sleep(60)

# Start automated surveillance
monitor = DailySurveillanceMonitor()
# monitor.start_monitoring()  # Uncomment to run
```

## ğŸ”¬ **Research Applications**

### 1. Antibody Cocktail Design
```python
def design_variant_resistant_cocktail(antibodies, gisaid_data):
    """
    Design cocktail covering maximum variants
    """
    # Analyze each antibody against variants
    coverage_matrix = []
    
    for ab in antibodies:
        coverage = analyze_variant_coverage(ab, gisaid_data)
        coverage_matrix.append(coverage)
    
    # Find optimal combination
    best_combination = optimize_cocktail_coverage(coverage_matrix)
    return best_combination
```

### 2. Escape Mutation Monitoring
```python
def monitor_escape_mutations(antibody_seq, gisaid_updates):
    """
    Track emergence of escape mutations
    """
    escape_positions = identify_escape_hotspots(antibody_seq)
    
    for update in gisaid_updates:
        new_mutations = extract_mutations(update)
        
        # Check if any affect escape positions
        escape_risk = assess_escape_risk(new_mutations, escape_positions)
        
        if escape_risk > threshold:
            trigger_alert(f"Escape mutation detected: {new_mutations}")
```

### 3. Pandemic Preparedness
```python
def assess_pandemic_readiness(antibody_library, emerging_variants):
    """
    Evaluate library coverage of emerging threats
    """
    readiness_scores = {}
    
    for variant in emerging_variants:
        coverage = 0
        for antibody in antibody_library:
            if predicts_neutralization(antibody, variant):
                coverage += 1
        
        readiness_scores[variant] = coverage / len(antibody_library)
    
    return readiness_scores
```

## ğŸ“ **Output Files Generated**

1. **`prevalence_timeline.html`** - Interactive variant prevalence over time
2. **`geographic_distribution.html`** - Global variant distribution map
3. **`surveillance_report.txt`** - Comprehensive text report
4. **`variant_alerts.txt`** - Alert notifications
5. **`emerging_threats.json`** - JSON data of emerging variants

## ğŸ”— **Data Sources**

- **GISAID**: https://www.gisaid.org
- **CoVariants**: https://covariants.org
- **Nextstrain**: https://nextstrain.org
- **CDC Variant Tracker**: https://covid.cdc.gov/covid-data-tracker/#variant-proportions

## ğŸ“ **Support**

For GISAID access issues:
- Contact: hcov-19@gisaid.org
- Documentation: https://www.gisaid.org/help

For technical issues with this module:
- Check the error logs in `./gisaid_surveillance/errors.log`
- Ensure all dependencies are installed
- Verify GISAID credentials are correct

## ğŸš¨ **Important Notes**

1. **GISAID Terms of Use**: Respect GISAID data sharing agreement
2. **Citation Requirements**: Cite GISAID in any publications
3. **Data Privacy**: Do not share patient-identifiable information
4. **Update Frequency**: GISAID updates continuously; check daily for best results